<jq:jqassistant-rules xmlns:jq="http://www.buschmais.com/jqassistant/core/analysis/rules/schema/v1.0">

    <queryDefinition id="ejbLocatedInPackageOrSubPackage">
        <description>Returns the names of all EJB classes which are not contained in the specified package.</description>
        <cypher><![CDATA[
            MATCH (p:PACKAGE)-[:CONTAINS]->(b)
            WHERE b:EJB AND NOT(p.FQN =~ {packageExpression})
            RETURN b.FQN as className
        ]]></cypher>
        <parameterDefinition name="packageExpression" type="string" />
    </queryDefinition>

    <constraint id="JpaEntitiesInApiModelPackage">
        <requiresConcept refId="JpaEntity" />
        <description>All JPA entities must be located in the package "persistence.api"</description>
        <cypher><![CDATA[
            MATCH (p:PACKAGE)-[:CONTAINS]->(e)
            WHERE e:JPA AND e:ENTITY AND NOT(p.FQN =~ {packageExpression})
            RETURN e.FQN as className
        ]]></cypher>
        <parameter name="packageExpression" type="string" value=".*\.persistence\.api\.model" />
    </constraint>

    <constraint id="EjbLocatedInImplementationPackage">
        <requiresConcept refId="StatelessSessionBean" />
        <requiresConcept refId="StatefulSessionBean" />
        <requiresConcept refId="MessageDrivenBean" />
        <description>All EJBs must be located in the package logic.impl or sub-packages.</description>
        <useQueryDefinition refId="ejbLocatedInPackageOrSubPackage" />
        <parameter name="packageExpression" type="string" value=".*\.logic\.impl" />
    </constraint>

    <!-- Constraint Groups -->
	<constraintGroup id="continuous">
        <includeConstraint refId="JpaEntitiesInApiModelPackage" />
		<includeConstraint refId="EjbLocatedInImplementationPackage" />
	</constraintGroup>

</jq:jqassistant-rules>