<jqa:jqassistant-rules xmlns:jqa="http://www.buschmais.com/jqassistant/core/analysis/rules/schema/v1.0">

    <queryDefinition id="EjbLocatedInPackageOrSubPackage">
        <description>Returns the names of all EJB classes which are not contained in the specified package.</description>
        <cypher><![CDATA[
            MATCH (p:PACKAGE)-[:CONTAINS]->(b)
            WHERE b:EJB AND NOT(p.FQN =~ {packageExpression})
            RETURN b.FQN as className
        ]]></cypher>
        <parameterDefinition name="packageExpression" type="string" />
    </queryDefinition>

    <constraint id="JpaEntitiesInApiModelPackage">
        <requiresConcept refId="jpa:Entity" />
        <description>All JPA entities must be located in the package "persistence.api"</description>
        <cypher><![CDATA[
            MATCH (p:PACKAGE)-[:CONTAINS]->(e)
            WHERE e:JPA AND e:ENTITY AND NOT(p.FQN =~ {packageExpression})
            RETURN e.FQN as className
        ]]></cypher>
        <parameter name="packageExpression" type="string" value=".*\.persistence\.api\.model" />
    </constraint>

    <constraint id="EjbLocatedInImplementationPackage">
        <requiresConcept refId="ejb3:StatelessSessionBean" />
        <requiresConcept refId="ejb3:StatefulSessionBean" />
        <requiresConcept refId="ejb3:MessageDrivenBean" />
        <requiresConcept refId="ejb3:Singleton" />
        <description>All EJBs must be located in the package logic.impl or sub-packages.</description>
        <useQueryDefinition refId="EjbLocatedInPackageOrSubPackage" />
        <parameter name="packageExpression" type="string" value=".*\.logic\.impl" />
    </constraint>

    <constraint id="TestClassNameHasTestSuffix">
        <requiresConcept refId="junit4:TestMethodsAndClasses" />
        <description>The name of all test classes must have the suffix "Test".</description>
        <cypher><![CDATA[
            MATCH (c:CLASS)
            WHERE c:TEST and NOT(c.FQN =~ {suffixExpression})
            RETURN c.FQN as className
        ]]></cypher>
        <parameter name="suffixExpression" type="string" value=".*Test" />
    </constraint>

    <!-- Constraint Groups -->
	<constraintGroup id="continuous">
        <includeConstraint refId="JpaEntitiesInApiModelPackage" />
		<includeConstraint refId="EjbLocatedInImplementationPackage" />
        <includeConstraint refId="TestClassNameHasTestSuffix" />
        <includeConstraint refId="layer:ApiMustNotDependOnImplementation" />
        <includeConstraint refId="layer:PersistenceAndLogicMustNotDependOnUi" />
        <includeConstraint refId="layer:PersistenceMustNotDependOnLogic" />
	</constraintGroup>

</jqa:jqassistant-rules>